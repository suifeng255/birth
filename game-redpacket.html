<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ¥çº¢åŒ… - é©¬å¹´æ–°æ˜¥å°æ¸¸æˆ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
            -webkit-tap-highlight-color: transparent; /* å»é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        }

        body {
            background: linear-gradient(135deg, #f5eedc 0%, #f8f5f0 100%);
            min-height: 100vh;
            padding: 10px; /* å‡å°ç§»åŠ¨ç«¯å†…è¾¹è· */
            touch-action: manipulation; /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸è¡Œä¸º */
        }

        /* å¤´éƒ¨æ ·å¼ */
        .game-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .game-title {
            font-size: clamp(20px, 7vw, 32px); /* ä¼˜åŒ–ç§»åŠ¨ç«¯å­—ä½“å°ºå¯¸ */
            color: #e67e22;
            margin-bottom: 8px;
        }

        .back-btn {
            display: inline-block;
            padding: 6px 16px;
            background: linear-gradient(90deg, #e67e22, #d35400);
            color: #fff;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px; /* é€‚é…ç§»åŠ¨ç«¯æŒ‰é’®æ–‡å­— */
        }

        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            width: 100%; /* ç§»åŠ¨ç«¯å®½åº¦100% */
            max-width: 100%; /* å–æ¶ˆæœ€å¤§å®½åº¦é™åˆ¶ */
            margin: 0 auto;
            background-color: #fff;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); /* å‡å°ç§»åŠ¨ç«¯é˜´å½± */
        }

        /* åˆ†æ•°æ˜¾ç¤º */
        .game-score {
            font-size: 18px;
            color: #e67e22;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            background-color: #f5eedc;
            padding: 8px;
            border-radius: 8px;
        }

        /* å€’è®¡æ—¶æ ·å¼ */
        .countdown {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            background-color: #ffeaea;
            padding: 8px;
            border-radius: 8px;
        }

        /* æ¸¸æˆåŒºåŸŸ - æ ¸å¿ƒç§»åŠ¨ç«¯é€‚é… */
        .game-area {
            width: 100%;
            height: clamp(250px, 50vh, 400px); /* åŸºäºè§†å£é«˜åº¦é€‚é… */
            background-color: #f8f5f0;
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            touch-action: none; /* ç¦ç”¨é»˜è®¤è§¦æ‘¸è¡Œä¸ºï¼Œé¿å…æ»šåŠ¨å†²çª */
        }

        /* ç©å®¶ï¼ˆæ¥çº¢åŒ…ç›’å­ï¼‰- ç§»åŠ¨ç«¯å°ºå¯¸ä¼˜åŒ– */
        .player {
            position: absolute;
            bottom: 15px; /* å‡å°åº•éƒ¨è·ç¦» */
            left: 50%;
            transform: translateX(-50%);
            width: clamp(40px, 12vw, 70px); /* å¢å¤§ç§»åŠ¨ç«¯å æ¯” */
            height: clamp(40px, 12vw, 70px);
            background-image: url("images/ç›’å­.png");
            background-size: cover;
            border-radius: 8px;
            z-index: 10;
            transition: left 0.08s ease; /* æ›´å¿«çš„å“åº”é€Ÿåº¦ */
        }

        /* çº¢åŒ… - ç¡®ä¿ç§»åŠ¨ç«¯å®Œæ•´æ˜¾ç¤º */
        .red-packet {
            position: absolute;
            top: -60px; /* ä¸Šç§»é¿å…åˆå§‹æ˜¾ç¤º */
            width: clamp(35px, 10vw, 55px); /* ä¼˜åŒ–ç§»åŠ¨ç«¯å°ºå¯¸ */
            height: calc(clamp(35px, 10vw, 55px) * 1.415); /* ä¿æŒæ¯”ä¾‹ */
            background-image: url("images/çº¢åŒ….jpg");
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            animation: fall linear;
            z-index: 5;
        }

        /* é™·é˜±çº¢åŒ… - ç§»åŠ¨ç«¯é€‚é… */
        .trap-packet {
            position: absolute;
            top: -60px;
            width: clamp(35px, 10vw, 55px);
            height: calc(clamp(35px, 10vw, 55px) * 1.415); /* ç»Ÿä¸€æ¯”ä¾‹ï¼Œç¡®ä¿å®Œæ•´æ˜¾ç¤º */
            background-image: url("images/ç‚¸å¼¹.jpg");
            background-size: contain; /* æ”¹ä¸ºcontainï¼Œé¿å…å›¾ç‰‡è£å‰ª */
            background-position: center;
            background-repeat: no-repeat;
            animation: fall linear;
            z-index: 5;
        }

        /* ä¸‹è½åŠ¨ç”» - é€‚é…ç§»åŠ¨ç«¯æ¸¸æˆåŒºåŸŸé«˜åº¦ */
        @keyframes fall {
            to {
                transform: translateY(clamp(250px, 50vh, 400px)); /* åŒ¹é…æ¸¸æˆåŒºåŸŸé«˜åº¦ */
            }
        }

        /* æ¸¸æˆç»Ÿè®¡ */
        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 8px;
            background-color: #f5eedc;
            border-radius: 8px;
        }

        .stat-item {
            font-size: 14px;
            color: #e67e22;
            font-weight: 600;
        }

        /* æ¸¸æˆæ§åˆ¶æŒ‰é’® - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .game-btn {
            padding: 8px 20px;
            background: linear-gradient(90deg, #e67e22, #d35400);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            min-width: 80px; /* å‡å°æœ€å°å®½åº¦ */
            height: 40px; /* å›ºå®šé«˜åº¦ï¼Œä¼˜åŒ–ç‚¹å‡»åŒºåŸŸ */
        }

        /* ç§»åŠ¨æ§åˆ¶æŒ‰é’® - ç§»åŠ¨ç«¯é‡ç‚¹ä¼˜åŒ– */
        .move-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .move-btn {
            padding: 12px 0; /* å‚ç›´paddingï¼Œå¢å¤§ç‚¹å‡»åŒºåŸŸ */
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            flex: 1; /* å æ»¡å®½åº¦ */
            min-width: 0; /* å–æ¶ˆæœ€å°å®½åº¦é™åˆ¶ */
            height: 50px; /* å¢å¤§ç§»åŠ¨ç«¯ç‚¹å‡»é«˜åº¦ */
        }

        /* æ’è¡Œæ¦œ */
        .game-rank {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f5eedc;
        }

        .rank-title {
            font-size: 16px;
            color: #e67e22;
            margin-bottom: 8px;
            text-align: center;
        }

        .rank-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .rank-list li {
            padding: 6px 12px;
            background-color: #fff;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            border-left: 3px solid #f1c40f;
            font-size: 14px; /* é€‚é…ç§»åŠ¨ç«¯æ–‡å­— */
        }

        /* éœ‡åŠ¨åŠ¨ç”» - é€‚é…ç§»åŠ¨ç«¯transform */
        @keyframes shake {
            0%, 100% {
                transform: translateX(-50%) rotate(0deg);
            }
            25% {
                transform: translateX(-50%) rotate(-5deg);
            }
            75% {
                transform: translateX(-50%) rotate(5deg);
            }
        }

        /* æ¸¸æˆç»“æŸæç¤º - ç§»åŠ¨ç«¯é€‚é… */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(20px, 8vw, 36px); /* å¢å¤§ç§»åŠ¨ç«¯å æ¯” */
            color: #e74c3c;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 100;
            text-align: center; /* ç¡®ä¿æ–‡å­—å±…ä¸­ */
            width: 90%; /* é™åˆ¶å®½åº¦ï¼Œé¿å…æº¢å‡º */
        }

        /* é€‚é…æ¨ªå±æ¨¡å¼ */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .game-area {
                height: clamp(180px, 80vh, 300px);
            }
            @keyframes fall {
                to {
                    transform: translateY(clamp(180px, 80vh, 300px));
                }
            }
            .move-btn {
                height: 40px;
                font-size: 14px;
            }
            .game-btn {
                height: 36px;
                font-size: 13px;
            }
        }

        /* å°å±æ‰‹æœºé€‚é… */
        @media screen and (max-width: 320px) {
            .game-container {
                padding: 10px;
            }
            .stat-item {
                font-size: 12px;
            }
            .move-controls {
                gap: 8px;
            }
        }
    </style>
</head>

<body>
    <div class="game-header">
        <a href="main.html" class="back-btn">â† è¿”å›ä¸»é¡µé¢</a>
        <h1 class="game-title">æ¥çº¢åŒ… ğŸ§§</h1>
    </div>

    <div class="game-container">
        <div class="game-score" id="redPacketScore">å¾—åˆ†ï¼š0</div>
        <div class="countdown" id="countdown">å€’è®¡æ—¶ï¼š60ç§’</div>

        <div class="game-area" id="redPacketGameArea">
            <div class="player" id="player"></div>
            <div class="game-over" id="gameOver">æ¸¸æˆç»“æŸï¼</div>
        </div>

        <div class="game-stats">
            <div class="stat-item">å·²æ¥çº¢åŒ…ï¼š<span id="redPacketCount">0</span></div>
            <div class="stat-item">é™·é˜±çº¢åŒ…ï¼š<span id="trapCount">0</span></div>
        </div>

        <!-- ç§»åŠ¨æ§åˆ¶æŒ‰é’® -->
        <div class="move-controls">
            <button class="move-btn" id="moveLeftBtn">â† å·¦ç§»</button>
            <button class="move-btn" id="moveRightBtn">å³ç§» â†’</button>
        </div>

        <div class="game-controls">
            <button class="game-btn" id="startRedPacketGame">å¼€å§‹</button>
            <button class="game-btn" id="pauseRedPacketGame" disabled>æš‚åœ</button>
            <button class="game-btn" id="resetRedPacketGame" disabled>é‡ç½®</button>
        </div>

        <div class="game-rank">
            <h3 class="rank-title">æ’è¡Œæ¦œ</h3>
            <ul class="rank-list" id="rankList"></ul>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ è·å–
        const redPacketScore = document.getElementById('redPacketScore');
        const redPacketGameArea = document.getElementById('redPacketGameArea');
        const player = document.getElementById('player');
        const startRedPacketGame = document.getElementById('startRedPacketGame');
        const pauseRedPacketGame = document.getElementById('pauseRedPacketGame');
        const resetRedPacketGame = document.getElementById('resetRedPacketGame');
        const redPacketCount = document.getElementById('redPacketCount');
        const trapCount = document.getElementById('trapCount');
        const rankList = document.getElementById('rankList');
        const countdownEl = document.getElementById('countdown');
        const gameOverEl = document.getElementById('gameOver');
        const moveLeftBtn = document.getElementById('moveLeftBtn');
        const moveRightBtn = document.getElementById('moveRightBtn');

        // æ¸¸æˆçŠ¶æ€å˜é‡
        let rpGameScore = 0;
        let rpGameInterval = null;
        let rpGameRunning = false;
        let rpGamePaused = false;
        let rpGameTime = 0;
        let rpTimeInterval = null;
        let redPacketCatchCount = 0;
        let trapCatchCount = 0;
        let rankData = [];
        let countdownTime = 60; // å€’è®¡æ—¶60ç§’
        let countdownInterval = null;

        // åˆå§‹åŒ–æ’è¡Œæ¦œ
        initRankList();

        // æ¸¸æˆæ§åˆ¶äº‹ä»¶
        startRedPacketGame.addEventListener('click', function () {
            if (!rpGameRunning) {
                startRedPacketGameFunc();
            } else if (rpGamePaused) {
                resumeRedPacketGame();
            }
        });

        pauseRedPacketGame.addEventListener('click', pauseRedPacketGameFunc);
        resetRedPacketGame.addEventListener('click', resetRedPacketGameFunc);

        // ç§»åŠ¨æŒ‰é’®æ§åˆ¶ - ä¼˜åŒ–ç§»åŠ¨ç«¯ç‚¹å‡»å“åº”
        moveLeftBtn.addEventListener('click', function () {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect();
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const moveStep = 20; // å‡å°ç§»åŠ¨ç«¯ç§»åŠ¨æ­¥é•¿ï¼Œæ›´ç²¾å‡†

            if (playerRect.left > gameAreaRect.left + 5) { // å¢åŠ è¾¹è·å®¹é”™
                player.style.left = `${player.offsetLeft - moveStep}px`;
            }
        });

        moveRightBtn.addEventListener('click', function () {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect();
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const moveStep = 20; // å‡å°ç§»åŠ¨ç«¯ç§»åŠ¨æ­¥é•¿

            if (playerRect.right < gameAreaRect.right - 5) { // å¢åŠ è¾¹è·å®¹é”™
                player.style.left = `${player.offsetLeft + moveStep}px`;
            }
        });

        // é”®ç›˜æ§åˆ¶ï¼ˆä¿ç•™ï¼Œé€‚é…ç§»åŠ¨ç«¯å¤–æ¥é”®ç›˜ï¼‰
        document.addEventListener('keydown', function (e) {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect();
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const moveStep = 12; // å‡å°ç§»åŠ¨ç«¯é”®ç›˜ç§»åŠ¨æ­¥é•¿

            switch (e.key) {
                case 'ArrowLeft':
                    if (playerRect.left > gameAreaRect.left + 5) {
                        player.style.left = `${player.offsetLeft - moveStep}px`;
                    }
                    break;
                case 'ArrowRight':
                    if (playerRect.right < gameAreaRect.right - 5) {
                        player.style.left = `${player.offsetLeft + moveStep}px`;
                    }
                    break;
            }
        });

        // ç§»åŠ¨ç«¯è§¦æ‘¸æ§åˆ¶ - æ ¸å¿ƒä¼˜åŒ–
        let touchStartX = 0;
        let playerBaseX = 0;

        // è§¦æ‘¸å¼€å§‹ - è®°å½•åˆå§‹ä½ç½®
        redPacketGameArea.addEventListener('touchstart', function (e) {
            if (!rpGameRunning || rpGamePaused) return;
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            playerBaseX = player.offsetLeft; // è®°å½•ç©å®¶åˆå§‹ä½ç½®
        });

        // è§¦æ‘¸ç§»åŠ¨ - å¹³æ»‘è·Ÿéšæ‰‹æŒ‡
        redPacketGameArea.addEventListener('touchmove', function (e) {
            if (!rpGameRunning || rpGamePaused) return;
            e.preventDefault();
            const touch = e.touches[0];
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const playerHalfWidth = player.offsetWidth / 2;
            
            // è®¡ç®—ç›¸å¯¹ç§»åŠ¨è·ç¦»
            const deltaX = touch.clientX - touchStartX;
            const newLeft = playerBaseX + deltaX;
            
            // é™åˆ¶è¾¹ç•Œï¼ˆç¡®ä¿ç©å®¶å®Œæ•´æ˜¾ç¤ºåœ¨æ¸¸æˆåŒºåŸŸå†…ï¼‰
            const minLeft = 0;
            const maxLeft = gameAreaRect.width - player.offsetWidth;
            
            if (newLeft >= minLeft && newLeft <= maxLeft) {
                player.style.left = `${newLeft}px`;
            }
        });

        // å¼€å§‹æ¸¸æˆ
        function startRedPacketGameFunc() {
            rpGameRunning = true;
            rpGamePaused = false;
            rpGameScore = 0;
            rpGameTime = 0;
            redPacketCatchCount = 0;
            trapCatchCount = 0;
            countdownTime = 60;
            gameOverEl.style.display = 'none';
            updateRedPacketScore();
            updateCountdown();

            // é‡ç½®ç©å®¶ä½ç½®
            player.style.left = `${(redPacketGameArea.offsetWidth - player.offsetWidth) / 2}px`; // ç²¾å‡†å±…ä¸­
            clearRedPacketGameArea();

            // ç”Ÿæˆçº¢åŒ…/é™·é˜±çº¢åŒ…å®šæ—¶å™¨ - ç§»åŠ¨ç«¯é™ä½ç”Ÿæˆé¢‘ç‡ï¼Œé¿å…æ‹¥æŒ¤
            rpGameInterval = setInterval(spawnRedPacketOrTrap, 900);

            // å€’è®¡æ—¶å®šæ—¶å™¨
            countdownInterval = setInterval(function () {
                countdownTime--;
                updateCountdown();

                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    endRedPacketGame();
                }
            }, 1000);

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'ç»§ç»­';
            pauseRedPacketGame.disabled = false;
            resetRedPacketGame.disabled = false;
        }

        // æš‚åœæ¸¸æˆ
        function pauseRedPacketGameFunc() {
            if (rpGameRunning && !rpGamePaused) {
                rpGamePaused = true;
                clearInterval(rpGameInterval);
                clearInterval(countdownInterval);

                // æš‚åœä¸‹è½åŠ¨ç”»
                document.querySelectorAll('.red-packet, .trap-packet').forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
                startRedPacketGame.textContent = 'ç»§ç»­';
            }
        }

        // æ¢å¤æ¸¸æˆ
        function resumeRedPacketGame() {
            rpGamePaused = false;
            rpGameInterval = setInterval(spawnRedPacketOrTrap, 900);

            // æ¢å¤å€’è®¡æ—¶
            countdownInterval = setInterval(function () {
                countdownTime--;
                updateCountdown();

                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    endRedPacketGame();
                }
            }, 1000);

            // æ¢å¤ä¸‹è½åŠ¨ç”»
            document.querySelectorAll('.red-packet, .trap-packet').forEach(el => {
                el.style.animationPlayState = 'running';
            });
        }

        // ç»“æŸæ¸¸æˆ
        function endRedPacketGame() {
            rpGameRunning = false;
            rpGamePaused = false;
            clearInterval(rpGameInterval);
            clearInterval(countdownInterval);
            gameOverEl.style.display = 'block';

            // æ›´æ–°æ’è¡Œæ¦œ
            rankData.push({ score: rpGameScore, time: 60 - countdownTime });
            rankData = rankData.sort((a, b) => b.score - a.score).slice(0, 5);
            initRankList();

            startRedPacketGame.textContent = 'å¼€å§‹';
            pauseRedPacketGame.disabled = true;
        }

        // åœæ­¢æ¸¸æˆ
        function stopRedPacketGame() {
            rpGameRunning = false;
            rpGamePaused = false;
            clearInterval(rpGameInterval);
            clearInterval(countdownInterval);
            clearRedPacketGameArea();
            gameOverEl.style.display = 'none';

            // é‡ç½®æ•°æ®
            rpGameScore = 0;
            rpGameTime = 0;
            redPacketCatchCount = 0;
            trapCatchCount = 0;
            countdownTime = 60;
            updateRedPacketScore();
            updateCountdown();
            player.style.left = `${(redPacketGameArea.offsetWidth - player.offsetWidth) / 2}px`;

            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'å¼€å§‹';
            pauseRedPacketGame.disabled = true;
            resetRedPacketGame.disabled = true;
        }

        // é‡ç½®æ¸¸æˆ
        function resetRedPacketGameFunc() {
            stopRedPacketGame();
            startRedPacketGameFunc();
        }

        // æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
        function clearRedPacketGameArea() {
            document.querySelectorAll('.red-packet, .trap-packet').forEach(el => el.remove());
        }

        // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
        function updateCountdown() {
            countdownEl.textContent = `å€’è®¡æ—¶ï¼š${countdownTime}ç§’`;
            if (countdownTime <= 10) {
                countdownEl.style.color = '#e74c3c';
                countdownEl.style.fontWeight = 'bold';
                countdownEl.style.fontSize = '20px'; // æœ€å10ç§’æ”¾å¤§æ–‡å­—
            } else {
                countdownEl.style.color = '#e74c3c';
                countdownEl.style.fontWeight = '600';
                countdownEl.style.fontSize = '18px';
            }
        }

        // ç”Ÿæˆçº¢åŒ…/é™·é˜±çº¢åŒ… - ç§»åŠ¨ç«¯ä¼˜åŒ–
        function spawnRedPacketOrTrap() {
            const gameAreaWidth = redPacketGameArea.offsetWidth;
            const randomType = Math.random();
            let element, isRedPacket, isTrapPacket;

            if (randomType < 0.75) {
                // æ™®é€šçº¢åŒ…
                element = document.createElement('div');
                element.className = 'red-packet';
                isRedPacket = true;
                isTrapPacket = false;
            } else {
                // é™·é˜±çº¢åŒ…
                element = document.createElement('div');
                element.className = 'trap-packet';
                isRedPacket = false;
                isTrapPacket = true;
            }

            // éšæœºä½ç½® - å¢å¤§è¾¹è·ï¼Œé¿å…çº¢åŒ…è´´è¾¹æ˜¾ç¤ºä¸å…¨
            const minX = 20; // æœ€å°Xåæ ‡
            const maxX = gameAreaWidth - element.offsetWidth - 20; // æœ€å¤§Xåæ ‡
            const randomX = Math.random() * (maxX - minX) + minX;
            element.style.left = `${randomX}px`;
            
            // ç§»åŠ¨ç«¯è°ƒæ•´ä¸‹è½é€Ÿåº¦ï¼ˆ3-6ç§’ï¼‰ï¼Œæ›´æ˜“æ“ä½œ
            const fallDuration = Math.random() * 3 + 3;
            element.style.animationDuration = `${fallDuration}s`;

            redPacketGameArea.appendChild(element);

            // ç¢°æ’æ£€æµ‹ - æé«˜æ£€æµ‹é¢‘ç‡ï¼Œé€‚é…ç§»åŠ¨ç«¯å¿«é€Ÿäº¤äº’
            const collisionCheck = setInterval(function () {
                const elRect = element.getBoundingClientRect();
                const pRect = player.getBoundingClientRect();
                const gameAreaRect = redPacketGameArea.getBoundingClientRect();

                // ä¼˜åŒ–ç¢°æ’æ£€æµ‹é€»è¾‘ï¼Œç¡®ä¿ç²¾å‡†
                const isCollided = (
                    elRect.bottom >= pRect.top - 5 && 
                    elRect.top <= pRect.bottom + 5 && 
                    elRect.right >= pRect.left - 5 && 
                    elRect.left <= pRect.right + 5
                );

                if (isCollided) {
                    clearInterval(collisionCheck);
                    element.remove();

                    if (isRedPacket) {
                        rpGameScore += 5;
                        redPacketCatchCount++;
                        updateRedPacketScore();
                    } else if (isTrapPacket) {
                        rpGameScore = Math.max(0, rpGameScore - 10);
                        trapCatchCount++;
                        updateRedPacketScore();
                        player.style.animation = 'shake 0.5s';
                        setTimeout(() => player.style.animation = '', 500);
                    }
                }

                // æ£€æµ‹è½åœ°
                if (elRect.top > gameAreaRect.bottom) {
                    clearInterval(collisionCheck);
                    element.remove();
                }
            }, 30); // æé«˜æ£€æµ‹é¢‘ç‡åˆ°30ms

            // åŠ¨ç”»ç»“æŸç§»é™¤å…ƒç´ 
            setTimeout(() => element.remove(), fallDuration * 1000);
        }

        // æ›´æ–°åˆ†æ•°/ç»Ÿè®¡
        function updateRedPacketScore() {
            redPacketScore.textContent = `å¾—åˆ†ï¼š${rpGameScore}`;
            redPacketCount.textContent = redPacketCatchCount;
            trapCount.textContent = trapCatchCount;

            if (rpGameRunning && !rpGamePaused) {
                const tempRankData = [...rankData, { score: rpGameScore, time: 60 - countdownTime }];
                const sortedTempData = tempRankData.sort((a, b) => b.score - a.score).slice(0, 5);
                renderRankList(sortedTempData);
            }
        }

        // åˆå§‹åŒ–æ’è¡Œæ¦œ
        function initRankList() {
            renderRankList(rankData);
        }

        // æ¸²æŸ“æ’è¡Œæ¦œ
        function renderRankList(data) {
            rankList.innerHTML = '';
            if (data.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'æš‚æ— æ¸¸æˆè®°å½•ï¼Œå¿«æ¥æŒ‘æˆ˜å§ï¼';
                rankList.appendChild(li);
                return;
            }
            data.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>ç¬¬${index + 1}å</span>
                    <span>å¾—åˆ†ï¼š${item.score} | ç”¨æ—¶ï¼š${item.time}s</span>
                `;
                rankList.appendChild(li);
            });
        }

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç½®ç©å®¶ä½ç½®ï¼Œé€‚é…å±å¹•æ—‹è½¬
        window.addEventListener('resize', function () {
            if (rpGameRunning && !rpGamePaused) {
                const gameAreaWidth = redPacketGameArea.offsetWidth;
                const playerWidth = player.offsetWidth;
                const currentLeft = player.offsetLeft;
                
                // ç¡®ä¿ç©å®¶ä»åœ¨æ¸¸æˆåŒºåŸŸå†…
                const newLeft = Math.max(0, Math.min(currentLeft, gameAreaWidth - playerWidth));
                player.style.left = `${newLeft}px`;
            }
        });
    </script>
</body>

</html>
