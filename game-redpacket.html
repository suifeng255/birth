<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥çº¢åŒ… - é©¬å¹´æ–°æ˜¥å°æ¸¸æˆ</title>
    <style>
        /* ===================== å…¨å±€æ ·å¼é‡ç½® ===================== */
        /* æ¸…é™¤æ‰€æœ‰å…ƒç´ é»˜è®¤å†…å¤–è¾¹è·ï¼Œç»Ÿä¸€ç›’æ¨¡å‹ï¼Œè®¾ç½®é»˜è®¤å­—ä½“ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* é¡µé¢ä¸»ä½“èƒŒæ™¯ï¼šæµ…ç±³è‰²æ¸å˜ï¼Œæœ€å°é«˜åº¦å æ»¡è§†å£ï¼Œæ·»åŠ å†…è¾¹è· */
        body {
            background: linear-gradient(135deg, #f5eedc 0%, #f8f5f0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* ===================== å¤´éƒ¨æ ·å¼ ===================== */
        .game-header {
            text-align: center; /* å†…å®¹å±…ä¸­ */
            margin-bottom: 20px; /* åº•éƒ¨å¤–è¾¹è· */
        }

        /* æ¸¸æˆæ ‡é¢˜ï¼šå“åº”å¼å­—ä½“å¤§å°ï¼Œæ©™è‰²è°ƒï¼Œåº•éƒ¨é—´è· */
        .game-title {
            font-size: clamp(24px, 5vw, 36px);
            color: #e67e22;
            margin-bottom: 10px;
        }

        /* è¿”å›æŒ‰é’®ï¼šæ¸å˜èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—ï¼Œåœ†è§’ï¼Œæ— ä¸‹åˆ’çº¿ */
        .back-btn {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(90deg, #e67e22, #d35400);
            color: #fff;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* ===================== æ¸¸æˆå®¹å™¨ ===================== */
        /* æ¸¸æˆä¸»å®¹å™¨ï¼šæœ€å¤§å®½åº¦é™åˆ¶ï¼Œå±…ä¸­ï¼Œç™½è‰²èƒŒæ™¯ï¼Œåœ†è§’ï¼Œé˜´å½± */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        /* ===================== åˆ†æ•°/å€’è®¡æ—¶æ˜¾ç¤º ===================== */
        /* åˆ†æ•°æ˜¾ç¤ºï¼šæ©™è‰²æ–‡å­—ï¼Œå±…ä¸­ï¼Œæµ…ç±³è‰²èƒŒæ™¯ï¼Œåœ†è§’å†…è¾¹è· */
        .game-score {
            font-size: 20px;
            color: #e67e22;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            background-color: #f5eedc;
            padding: 10px;
            border-radius: 10px;
        }

        /* å€’è®¡æ—¶æ˜¾ç¤ºï¼šçº¢è‰²æ–‡å­—ï¼Œå±…ä¸­ï¼Œæµ…çº¢èƒŒæ™¯ï¼Œåœ†è§’å†…è¾¹è· */
        .countdown {
            font-size: 20px;
            color: #e74c3c;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            background-color: #ffeaea;
            padding: 10px;
            border-radius: 10px;
        }

        /* ===================== æ¸¸æˆåŒºåŸŸ ===================== */
        /* æ¸¸æˆæ ¸å¿ƒåŒºåŸŸï¼šå“åº”å¼é«˜åº¦ï¼Œæµ…ç±³è‰²èƒŒæ™¯ï¼Œåœ†è§’ï¼Œç›¸å¯¹å®šä½ï¼ˆç”¨äºå­å…ƒç´ ç»å¯¹å®šä½ï¼‰ï¼Œæº¢å‡ºéšè— */
        .game-area {
            width: 100%;
            height: clamp(300px, 60vw, 450px);
            background-color: #f8f5f0;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        /* ===================== ç©å®¶ï¼ˆæ¥çº¢åŒ…ç›’å­ï¼‰ ===================== */
        /* ç©å®¶ç›’å­ï¼šç»å¯¹å®šä½ï¼ˆåº•éƒ¨å±…ä¸­ï¼‰ï¼Œå“åº”å¼å®½é«˜ï¼ŒèƒŒæ™¯å›¾ç‰‡ï¼Œåœ†è§’ï¼Œå±‚çº§é«˜äºä¸‹è½å…ƒç´  */
        .player {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            width: clamp(50px, 10vw, 80px);
            height: clamp(50px, 10vw, 80px);
            background-image: url("images/box.png"); /* æœ¬åœ°ç›’å­å›¾ç‰‡ï¼ˆéœ€æ›¿æ¢å®é™…è·¯å¾„ï¼‰ */
            background-size: cover; /* èƒŒæ™¯å›¾ç‰‡è¦†ç›–å®¹å™¨ */
            border-radius: 8px;
            z-index: 10; /* ç¡®ä¿ç©å®¶åœ¨æœ€ä¸Šå±‚ */
            transition: left 0.1s ease; /* ç§»åŠ¨è¿‡æ¸¡åŠ¨ç”»ï¼Œæ›´ä¸æ»‘ */
        }

        /* ===================== ä¸‹è½å…ƒç´ æ ·å¼ï¼ˆçº¢åŒ…/é™·é˜±/éšœç¢ç‰©ï¼‰ ===================== */
        /* æ™®é€šçº¢åŒ…ï¼šç»å¯¹å®šä½ï¼ˆé¡¶éƒ¨å¤–ï¼‰ï¼Œå“åº”å¼å®½é«˜ï¼ŒèƒŒæ™¯å›¾ç‰‡ï¼Œä¸‹è½åŠ¨ç”» */
        .red-packet {
            position: absolute;
            top: -50px; /* åˆå§‹ä½ç½®åœ¨æ¸¸æˆåŒºåŸŸå¤–é¡¶éƒ¨ */
            width: clamp(40px, 8vw, 60px); /* å“åº”å¼å®½åº¦ */
            height: calc(clamp(40px, 8vw, 60px) * 1.415); /* æŒ‰å›¾ç‰‡æ¯”ä¾‹è®¡ç®—é«˜åº¦ */
            background-image: url("images/hongbao.jpg"); /* æ™®é€šçº¢åŒ…å›¾ç‰‡ï¼ˆéœ€æ›¿æ¢ï¼‰ */
            background-size: contain; /* å®Œæ•´æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¸è£å‰ª */
            background-position: center; /* èƒŒæ™¯å±…ä¸­ */
            background-repeat: no-repeat; /* ç¦æ­¢é‡å¤ */
            animation: fall linear; /* ç»‘å®šä¸‹è½åŠ¨ç”»ï¼ˆçº¿æ€§é€Ÿåº¦ï¼‰ */
        }

        /* é™·é˜±çº¢åŒ…ï¼šæ ·å¼ç±»ä¼¼æ™®é€šçº¢åŒ…ï¼ŒèƒŒæ™¯å›¾ä¸åŒ */
        .trap-packet {
            position: absolute;
            top: -50px;
            width: clamp(40px, 8vw, 60px);
            height: clamp(50px, 10vw, 70px);
            background-image: url("images/boom.jpg"); /* é™·é˜±çº¢åŒ…å›¾ç‰‡ï¼ˆéœ€æ›¿æ¢ï¼‰ */
            background-size: cover;
            animation: fall linear;
        }

        /* éšœç¢ç‰©ï¼šæ ·å¼ç±»ä¼¼çº¢åŒ…ï¼Œæš‚æœªè®¾ç½®èƒŒæ™¯å›¾ï¼ˆéœ€è¡¥å……ï¼‰ */
        .obstacle {
            position: absolute;
            top: -50px;
            width: clamp(40px, 8vw, 60px);
            height: clamp(40px, 8vw, 60px);
            background-image: url(""); /* éšœç¢ç‰©å›¾ç‰‡ï¼ˆéœ€è¡¥å……ï¼‰ */
            background-size: cover;
            animation: fall linear;
        }

        /* ä¸‹è½åŠ¨ç”»ï¼šä»é¡¶éƒ¨ç§»åŠ¨åˆ°æ¸¸æˆåŒºåŸŸåº•éƒ¨ */
        @keyframes fall {
            to {
                transform: translateY(clamp(300px, 60vw, 450px)); /* ç§»åŠ¨è·ç¦»åŒ¹é…æ¸¸æˆåŒºåŸŸé«˜åº¦ */
            }
        }

        /* ===================== æ¸¸æˆç»Ÿè®¡ ===================== */
        /* ç»Ÿè®¡å®¹å™¨ï¼šå¼¹æ€§å¸ƒå±€ï¼Œå‡åŒ€åˆ†å¸ƒï¼Œæµ…ç±³è‰²èƒŒæ™¯ï¼Œåœ†è§’ */
        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f5eedc;
            border-radius: 10px;
        }

        /* ç»Ÿè®¡é¡¹ï¼šæ©™è‰²æ–‡å­—ï¼ŒåŠ ç²— */
        .stat-item {
            font-size: 16px;
            color: #e67e22;
            font-weight: 600;
        }

        /* ===================== æ¸¸æˆæ§åˆ¶æŒ‰é’® ===================== */
        /* æ§åˆ¶æŒ‰é’®å®¹å™¨ï¼šå¼¹æ€§å¸ƒå±€ï¼Œå±…ä¸­ï¼Œé—´è·ï¼Œè‡ªåŠ¨æ¢è¡Œ */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        /* æ¸¸æˆæŒ‰é’®ï¼šæ¸å˜èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—ï¼Œæ— è¾¹æ¡†ï¼Œåœ†è§’ï¼Œå¼¹æ€§å æ¯”ï¼Œæœ€å°å®½åº¦ */
        .game-btn {
            padding: 10px 25px;
            background: linear-gradient(90deg, #e67e22, #d35400);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            min-width: 100px;
        }

        /* ===================== ç§»åŠ¨æ§åˆ¶æŒ‰é’® ===================== */
        /* ç§»åŠ¨æŒ‰é’®å®¹å™¨ï¼šå¼¹æ€§å¸ƒå±€ï¼Œå±…ä¸­ï¼Œé—´è· */
        .move-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* ç§»åŠ¨æŒ‰é’®ï¼šè“è‰²æ¸å˜ï¼Œæ›´å¤§çš„å†…è¾¹è·ï¼Œæ›´å¤§å­—ä½“ */
        .move-btn {
            padding: 15px 30px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            min-width: 120px;
        }

        /* ===================== æ’è¡Œæ¦œ ===================== */
        /* æ’è¡Œæ¦œå®¹å™¨ï¼šé¡¶éƒ¨é—´è·ï¼Œä¸Šè¾¹æ¡†åˆ†éš” */
        .game-rank {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f5eedc;
        }

        /* æ’è¡Œæ¦œæ ‡é¢˜ï¼šæ©™è‰²æ–‡å­—ï¼Œå±…ä¸­ï¼Œåº•éƒ¨é—´è· */
        .rank-title {
            font-size: 18px;
            color: #e67e22;
            margin-bottom: 10px;
            text-align: center;
        }

        /* æ’è¡Œæ¦œåˆ—è¡¨ï¼šæ— åˆ—è¡¨æ ·å¼ï¼Œå¼¹æ€§å‚ç›´å¸ƒå±€ï¼Œé¡¹é—´è· */
        .rank-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* æ’è¡Œæ¦œåˆ—è¡¨é¡¹ï¼šç™½è‰²èƒŒæ™¯ï¼Œåœ†è§’ï¼Œå¼¹æ€§å¸ƒå±€ï¼Œä¸¤ç«¯å¯¹é½ï¼Œå·¦ä¾§é»„è‰²è¾¹æ¡† */
        .rank-list li {
            padding: 8px 15px;
            background-color: #fff;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            border-left: 3px solid #f1c40f;
        }

        /* ===================== éœ‡åŠ¨åŠ¨ç”»ï¼ˆç¢°æ’é™·é˜±/éšœç¢ç‰©æ—¶ï¼‰ ===================== */
        @keyframes shake {
            0%, 100% {
                transform: translateX(-50%) rotate(0deg); /* åˆå§‹/ç»“æŸä½ç½® */
            }
            25% {
                transform: translateX(-50%) rotate(-5deg); /* å·¦æ—‹è½¬ */
            }
            75% {
                transform: translateX(-50%) rotate(5deg); /* å³æ—‹è½¬ */
            }
        }

        /* ===================== æ¸¸æˆç»“æŸæç¤º ===================== */
        /* æ¸¸æˆç»“æŸæ–‡å­—ï¼šç»å¯¹å±…ä¸­ï¼Œå“åº”å¼å­—ä½“ï¼Œçº¢è‰²ï¼ŒåŠ ç²—ï¼Œæ–‡å­—é˜´å½±ï¼Œé»˜è®¤éšè—ï¼Œæœ€é«˜å±‚çº§ */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(24px, 6vw, 40px);
            color: #e74c3c;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 100;
        }
    </style>
</head>

<body>
    <!-- æ¸¸æˆå¤´éƒ¨ï¼šè¿”å›æŒ‰é’® + æ ‡é¢˜ -->
    <div class="game-header">
        <a href="main.html" class="back-btn">â† è¿”å›ä¸»é¡µé¢</a>
        <h1 class="game-title">æ¥çº¢åŒ… ğŸ§§</h1>
    </div>

    <!-- æ¸¸æˆä¸»å®¹å™¨ -->
    <div class="game-container">
        <!-- åˆ†æ•°æ˜¾ç¤º -->
        <div class="game-score" id="redPacketScore">å¾—åˆ†ï¼š0</div>
        <!-- å€’è®¡æ—¶æ˜¾ç¤º -->
        <div class="countdown" id="countdown">å€’è®¡æ—¶ï¼š60ç§’</div>

        <!-- æ¸¸æˆæ ¸å¿ƒåŒºåŸŸï¼šç©å®¶ + ä¸‹è½å…ƒç´  + æ¸¸æˆç»“æŸæç¤º -->
        <div class="game-area" id="redPacketGameArea">
            <div class="player" id="player"></div>
            <div class="game-over" id="gameOver">æ¸¸æˆç»“æŸï¼</div>
        </div>

        <!-- æ¸¸æˆç»Ÿè®¡ï¼šå·²æ¥çº¢åŒ…/å·²é¿éšœç¢/é™·é˜±çº¢åŒ…æ•°é‡ -->
        <div class="game-stats">
            <div class="stat-item">å·²æ¥çº¢åŒ…ï¼š<span id="redPacketCount">0</span></div>
            <div class="stat-item">å·²é¿éšœç¢ï¼š<span id="obstacleCount">0</span></div>
            <div class="stat-item">é™·é˜±çº¢åŒ…ï¼š<span id="trapCount">0</span></div>
        </div>

        <!-- ç§»åŠ¨æ§åˆ¶æŒ‰é’®ï¼šå·¦ç§»/å³ç§» -->
        <div class="move-controls">
            <button class="move-btn" id="moveLeftBtn">â† å·¦ç§»</button>
            <button class="move-btn" id="moveRightBtn">å³ç§» â†’</button>
        </div>

        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’®ï¼šå¼€å§‹/æš‚åœ/é‡ç½® -->
        <div class="game-controls">
            <button class="game-btn" id="startRedPacketGame">å¼€å§‹</button>
            <button class="game-btn" id="pauseRedPacketGame" disabled>æš‚åœ</button>
            <button class="game-btn" id="resetRedPacketGame" disabled>é‡ç½®</button>
        </div>

        <!-- æ’è¡Œæ¦œåŒºåŸŸ -->
        <div class="game-rank">
            <h3 class="rank-title">æ’è¡Œæ¦œ</h3>
            <ul class="rank-list" id="rankList"></ul>
        </div>
    </div>

    <script>
        // ===================== DOMå…ƒç´ è·å– =====================
        // åˆ†æ•°æ˜¾ç¤ºå…ƒç´ 
        const redPacketScore = document.getElementById('redPacketScore');
        // æ¸¸æˆæ ¸å¿ƒåŒºåŸŸ
        const redPacketGameArea = document.getElementById('redPacketGameArea');
        // ç©å®¶å…ƒç´ 
        const player = document.getElementById('player');
        // æ¸¸æˆæ§åˆ¶æŒ‰é’®
        const startRedPacketGame = document.getElementById('startRedPacketGame');
        const pauseRedPacketGame = document.getElementById('pauseRedPacketGame');
        const resetRedPacketGame = document.getElementById('resetRedPacketGame');
        // ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºå…ƒç´ 
        const redPacketCount = document.getElementById('redPacketCount');
        const obstacleCount = document.getElementById('obstacleCount');
        const trapCount = document.getElementById('trapCount');
        // æ’è¡Œæ¦œåˆ—è¡¨
        const rankList = document.getElementById('rankList');
        // å€’è®¡æ—¶æ˜¾ç¤ºå…ƒç´ 
        const countdownEl = document.getElementById('countdown');
        // æ¸¸æˆç»“æŸæç¤ºå…ƒç´ 
        const gameOverEl = document.getElementById('gameOver');
        // ç§»åŠ¨æ§åˆ¶æŒ‰é’®
        const moveLeftBtn = document.getElementById('moveLeftBtn');
        const moveRightBtn = document.getElementById('moveRightBtn');

        // ===================== æ¸¸æˆçŠ¶æ€å˜é‡ =====================
        let rpGameScore = 0; // å½“å‰å¾—åˆ†
        let rpGameInterval = null; // ç”Ÿæˆä¸‹è½å…ƒç´ çš„å®šæ—¶å™¨
        let rpGameRunning = false; // æ¸¸æˆæ˜¯å¦è¿è¡Œä¸­
        let rpGamePaused = false; // æ¸¸æˆæ˜¯å¦æš‚åœ
        let rpGameTime = 0; // æ¸¸æˆæ—¶é•¿ï¼ˆå¤‡ç”¨ï¼‰
        let rpTimeInterval = null; // å¤‡ç”¨å®šæ—¶å™¨
        let redPacketCatchCount = 0; // å·²æ¥æ™®é€šçº¢åŒ…æ•°é‡
        let obstacleAvoidCount = 0; // å·²é¿éšœç¢/é™·é˜±æ•°é‡
        let trapCatchCount = 0; // å·²æ¥é™·é˜±çº¢åŒ…æ•°é‡
        let rankData = []; // æ’è¡Œæ¦œæ•°æ®ï¼ˆ{score: å¾—åˆ†, time: ç”¨æ—¶}ï¼‰
        let countdownTime = 60; // å€’è®¡æ—¶æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
        let countdownInterval = null; // å€’è®¡æ—¶å®šæ—¶å™¨

        // åˆå§‹åŒ–æ’è¡Œæ¦œï¼ˆé¡µé¢åŠ è½½æ—¶æ‰§è¡Œï¼‰
        initRankList();

        // ===================== äº‹ä»¶ç»‘å®š =====================
        /**
         * å¼€å§‹/ç»§ç»­æ¸¸æˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
         * - æœªè¿è¡Œï¼šå¯åŠ¨æ¸¸æˆ
         * - å·²æš‚åœï¼šæ¢å¤æ¸¸æˆ
         */
        startRedPacketGame.addEventListener('click', function () {
            if (!rpGameRunning) {
                startRedPacketGameFunc();
            } else if (rpGamePaused) {
                resumeRedPacketGame();
            }
        });

        // æš‚åœæ¸¸æˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        pauseRedPacketGame.addEventListener('click', pauseRedPacketGameFunc);
        // é‡ç½®æ¸¸æˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        resetRedPacketGame.addEventListener('click', resetRedPacketGameFunc);

        /**
         * å·¦ç§»æŒ‰é’®ç‚¹å‡»äº‹ä»¶
         * - æ¸¸æˆæœªè¿è¡Œ/æš‚åœæ—¶ä¸å“åº”
         * - æ£€æµ‹è¾¹ç•Œï¼Œé¿å…ç§»å‡ºæ¸¸æˆåŒºåŸŸ
         */
        moveLeftBtn.addEventListener('click', function () {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect(); // ç©å®¶å…ƒç´ ä½ç½®/å°ºå¯¸
            const gameAreaRect = redPacketGameArea.getBoundingClientRect(); // æ¸¸æˆåŒºåŸŸä½ç½®/å°ºå¯¸
            const moveStep = 25; // å•æ¬¡ç§»åŠ¨æ­¥é•¿

            // å·¦è¾¹ç•Œæ£€æµ‹ï¼šç©å®¶å·¦ä¾§æœªè¶…å‡ºæ¸¸æˆåŒºåŸŸå·¦ä¾§
            if (playerRect.left > gameAreaRect.left) {
                player.style.left = `${player.offsetLeft - moveStep}px`;
            }
        });

        /**
         * å³ç§»æŒ‰é’®ç‚¹å‡»äº‹ä»¶
         * - æ¸¸æˆæœªè¿è¡Œ/æš‚åœæ—¶ä¸å“åº”
         * - æ£€æµ‹è¾¹ç•Œï¼Œé¿å…ç§»å‡ºæ¸¸æˆåŒºåŸŸ
         */
        moveRightBtn.addEventListener('click', function () {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect();
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const moveStep = 25; // å•æ¬¡ç§»åŠ¨æ­¥é•¿

            // å³è¾¹ç•Œæ£€æµ‹ï¼šç©å®¶å³ä¾§æœªè¶…å‡ºæ¸¸æˆåŒºåŸŸå³ä¾§
            if (playerRect.right < gameAreaRect.right) {
                player.style.left = `${player.offsetLeft + moveStep}px`;
            }
        });

        /**
         * é”®ç›˜æ–¹å‘é”®æ§åˆ¶ï¼ˆå¯é€‰ï¼‰
         * - å·¦ç®­å¤´ï¼šå·¦ç§»
         * - å³ç®­å¤´ï¼šå³ç§»
         * - è¾¹ç•Œæ£€æµ‹ï¼Œé¿å…ç§»å‡ºæ¸¸æˆåŒºåŸŸ
         */
        document.addEventListener('keydown', function (e) {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect();
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const moveStep = 15; // é”®ç›˜æ§åˆ¶æ­¥é•¿ï¼ˆæ›´ç»†è…»ï¼‰

            switch (e.key) {
                case 'ArrowLeft': // å·¦ç®­å¤´
                    if (playerRect.left > gameAreaRect.left) {
                        player.style.left = `${player.offsetLeft - moveStep}px`;
                    }
                    break;
                case 'ArrowRight': // å³ç®­å¤´
                    if (playerRect.right < gameAreaRect.right) {
                        player.style.left = `${player.offsetLeft + moveStep}px`;
                    }
                    break;
            }
        });

        /**
         * ç§»åŠ¨ç«¯è§¦æ‘¸æ§åˆ¶ï¼ˆå¯é€‰ï¼‰
         * - è§¦æ‘¸æ»‘åŠ¨æ—¶ï¼Œç©å®¶è·Ÿéšè§¦æ‘¸ä½ç½®ç§»åŠ¨
         * - è¾¹ç•Œæ£€æµ‹ï¼Œé¿å…ç§»å‡ºæ¸¸æˆåŒºåŸŸ
         */
        redPacketGameArea.addEventListener('touchmove', function (e) {
            if (!rpGameRunning || rpGamePaused) return;
            e.preventDefault(); // é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
            const touch = e.touches[0]; // è·å–ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const playerHalfWidth = player.offsetWidth / 2; // ç©å®¶åŠå®½ï¼ˆç”¨äºå±…ä¸­ï¼‰
            const relativeX = touch.clientX - gameAreaRect.left; // è§¦æ‘¸ç‚¹ç›¸å¯¹æ¸¸æˆåŒºåŸŸçš„Xåæ ‡

            // è¾¹ç•Œæ£€æµ‹ï¼šè§¦æ‘¸ç‚¹åœ¨æ¸¸æˆåŒºåŸŸå†…ï¼ˆæ‰£é™¤ç©å®¶åŠå®½ï¼‰
            if (relativeX > playerHalfWidth && relativeX < gameAreaRect.width - playerHalfWidth) {
                player.style.left = `${relativeX - playerHalfWidth}px`;
            }
        });

        // ===================== æ¸¸æˆæ ¸å¿ƒé€»è¾‘å‡½æ•° =====================
        /**
         * å¯åŠ¨æ¸¸æˆå‡½æ•°
         * - é‡ç½®æ¸¸æˆçŠ¶æ€ï¼ˆåˆ†æ•°ã€è®¡æ•°ã€å€’è®¡æ—¶ï¼‰
         * - é‡ç½®ç©å®¶ä½ç½®
         * - å¯åŠ¨ä¸‹è½å…ƒç´ ç”Ÿæˆå®šæ—¶å™¨
         * - å¯åŠ¨å€’è®¡æ—¶å®šæ—¶å™¨
         * - æ›´æ–°æŒ‰é’®çŠ¶æ€
         */
        function startRedPacketGameFunc() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            rpGameRunning = true;
            rpGamePaused = false;
            rpGameScore = 0;
            rpGameTime = 0;
            redPacketCatchCount = 0;
            obstacleAvoidCount = 0;
            trapCatchCount = 0;
            countdownTime = 60; // é‡ç½®å€’è®¡æ—¶
            gameOverEl.style.display = 'none'; // éšè—æ¸¸æˆç»“æŸæç¤º
            updateRedPacketScore(); // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateCountdown(); // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º

            // é‡ç½®ç©å®¶ä½ç½®åˆ°æ¸¸æˆåŒºåŸŸåº•éƒ¨å±…ä¸­
            player.style.left = '50%';
            clearRedPacketGameArea(); // æ¸…ç©ºæ¸¸æˆåŒºåŸŸå†…çš„ä¸‹è½å…ƒç´ 

            // å¯åŠ¨ä¸‹è½å…ƒç´ ç”Ÿæˆå®šæ—¶å™¨ï¼ˆæ¯800msç”Ÿæˆä¸€ä¸ªï¼‰
            rpGameInterval = setInterval(spawnRedPacketOrObstacle, 800);

            // å¯åŠ¨å€’è®¡æ—¶å®šæ—¶å™¨ï¼ˆæ¯ç§’æ‰§è¡Œï¼‰
            countdownInterval = setInterval(function () {
                countdownTime--; // å€’è®¡æ—¶å‡1
                updateCountdown(); // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º

                // å€’è®¡æ—¶ç»“æŸï¼Œè§¦å‘æ¸¸æˆç»“æŸ
                if (countdownTime <= 0) {
                    clearInterval(countdownInterval); // æ¸…é™¤å€’è®¡æ—¶å®šæ—¶å™¨
                    endRedPacketGame(); // æ‰§è¡Œæ¸¸æˆç»“æŸé€»è¾‘
                }
            }, 1000);

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'ç»§ç»­'; // æŒ‰é’®æ–‡å­—æ”¹ä¸ºâ€œç»§ç»­â€ï¼ˆç”¨äºæš‚åœåæ¢å¤ï¼‰
            pauseRedPacketGame.disabled = false; // å¯ç”¨æš‚åœæŒ‰é’®
            resetRedPacketGame.disabled = false; // å¯ç”¨é‡ç½®æŒ‰é’®
        }

        /**
         * æš‚åœæ¸¸æˆå‡½æ•°
         * - ä»…åœ¨æ¸¸æˆè¿è¡Œä¸”æœªæš‚åœæ—¶ç”Ÿæ•ˆ
         * - æ¸…é™¤ä¸‹è½å…ƒç´ ç”Ÿæˆå®šæ—¶å™¨
         * - æ¸…é™¤å€’è®¡æ—¶å®šæ—¶å™¨
         * - æš‚åœæ‰€æœ‰ä¸‹è½å…ƒç´ çš„åŠ¨ç”»
         * - æ›´æ–°å¼€å§‹æŒ‰é’®æ–‡å­—ä¸ºâ€œç»§ç»­â€
         */
        function pauseRedPacketGameFunc() {
            if (rpGameRunning && !rpGamePaused) {
                rpGamePaused = true;
                clearInterval(rpGameInterval); // åœæ­¢ç”Ÿæˆä¸‹è½å…ƒç´ 
                clearInterval(countdownInterval); // åœæ­¢å€’è®¡æ—¶

                // æš‚åœæ‰€æœ‰ä¸‹è½å…ƒç´ çš„åŠ¨ç”»
                document.querySelectorAll('.red-packet, .obstacle, .trap-packet').forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
                startRedPacketGame.textContent = 'ç»§ç»­'; // æ›´æ–°æŒ‰é’®æ–‡å­—
            }
        }

        /**
         * æ¢å¤æ¸¸æˆå‡½æ•°
         * - æ¢å¤ä¸‹è½å…ƒç´ ç”Ÿæˆå®šæ—¶å™¨
         * - æ¢å¤å€’è®¡æ—¶å®šæ—¶å™¨
         * - æ¢å¤æ‰€æœ‰ä¸‹è½å…ƒç´ çš„åŠ¨ç”»
         */
        function resumeRedPacketGame() {
            rpGamePaused = false;
            // é‡å¯ä¸‹è½å…ƒç´ ç”Ÿæˆå®šæ—¶å™¨
            rpGameInterval = setInterval(spawnRedPacketOrObstacle, 800);

            // é‡å¯å€’è®¡æ—¶å®šæ—¶å™¨
            countdownInterval = setInterval(function () {
                countdownTime--;
                updateCountdown();

                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    endRedPacketGame();
                }
            }, 1000);

            // æ¢å¤æ‰€æœ‰ä¸‹è½å…ƒç´ çš„åŠ¨ç”»
            document.querySelectorAll('.red-packet, .obstacle, .trap-packet').forEach(el => {
                el.style.animationPlayState = 'running';
            });
        }

        /**
         * æ¸¸æˆç»“æŸå‡½æ•°
         * - åœæ­¢æ‰€æœ‰å®šæ—¶å™¨
         * - æ˜¾ç¤ºæ¸¸æˆç»“æŸæç¤º
         * - æ›´æ–°æ’è¡Œæ¦œï¼ˆä¿ç•™å‰5åï¼‰
         * - é‡ç½®æŒ‰é’®çŠ¶æ€
         */
        function endRedPacketGame() {
            rpGameRunning = false;
            rpGamePaused = false;
            clearInterval(rpGameInterval); // æ¸…é™¤ä¸‹è½å…ƒç´ å®šæ—¶å™¨
            clearInterval(countdownInterval); // æ¸…é™¤å€’è®¡æ—¶å®šæ—¶å™¨
            gameOverEl.style.display = 'block'; // æ˜¾ç¤ºæ¸¸æˆç»“æŸæç¤º

            // æ›´æ–°æ’è¡Œæ¦œï¼šæ·»åŠ å½“å‰æˆç»© â†’ æŒ‰å¾—åˆ†é™åºæ’åº â†’ ä¿ç•™å‰5å
            rankData.push({ score: rpGameScore, time: 60 - countdownTime });
            rankData = rankData.sort((a, b) => b.score - a.score).slice(0, 5);
            initRankList(); // é‡æ–°æ¸²æŸ“æ’è¡Œæ¦œ

            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'å¼€å§‹'; // æ¢å¤ä¸ºâ€œå¼€å§‹â€
            pauseRedPacketGame.disabled = true; // ç¦ç”¨æš‚åœæŒ‰é’®
            // resetRedPacketGame ä¿æŒå¯ç”¨ï¼Œæ–¹ä¾¿é‡æ–°å¼€å§‹
        }

        /**
         * åœæ­¢æ¸¸æˆå‡½æ•°ï¼ˆé‡ç½®å‰çš„æ¸…ç†å·¥ä½œï¼‰
         * - åœæ­¢æ‰€æœ‰å®šæ—¶å™¨
         * - æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
         * - éšè—æ¸¸æˆç»“æŸæç¤º
         * - é‡ç½®æ‰€æœ‰æ¸¸æˆæ•°æ®
         * - é‡ç½®ç©å®¶ä½ç½®
         * - é‡ç½®æŒ‰é’®çŠ¶æ€
         */
        function stopRedPacketGame() {
            rpGameRunning = false;
            rpGamePaused = false;
            clearInterval(rpGameInterval);
            clearInterval(countdownInterval);
            clearRedPacketGameArea(); // æ¸…ç©ºä¸‹è½å…ƒç´ 
            gameOverEl.style.display = 'none'; // éšè—æ¸¸æˆç»“æŸæç¤º

            // é‡ç½®æ‰€æœ‰æ¸¸æˆæ•°æ®
            rpGameScore = 0;
            rpGameTime = 0;
            redPacketCatchCount = 0;
            obstacleAvoidCount = 0;
            trapCatchCount = 0;
            countdownTime = 60;
            updateRedPacketScore(); // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateCountdown(); // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
            player.style.left = '50%'; // é‡ç½®ç©å®¶ä½ç½®

            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'å¼€å§‹';
            pauseRedPacketGame.disabled = true;
            resetRedPacketGame.disabled = true;
        }

        /**
         * é‡ç½®æ¸¸æˆå‡½æ•°
         * - å…ˆåœæ­¢æ¸¸æˆï¼ˆæ¸…ç†çŠ¶æ€ï¼‰
         * - å†å¯åŠ¨æ¸¸æˆï¼ˆé‡ç½®åé‡æ–°å¼€å§‹ï¼‰
         */
        function resetRedPacketGameFunc() {
            stopRedPacketGame();
            startRedPacketGameFunc();
        }

        /**
         * æ¸…ç©ºæ¸¸æˆåŒºåŸŸå‡½æ•°
         * - ç§»é™¤æ‰€æœ‰ä¸‹è½å…ƒç´ ï¼ˆçº¢åŒ…/é™·é˜±/éšœç¢ç‰©ï¼‰
         */
        function clearRedPacketGameArea() {
            document.querySelectorAll('.red-packet, .obstacle, .trap-packet').forEach(el => el.remove());
        }

        /**
         * æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤ºå‡½æ•°
         * - æ›´æ–°å€’è®¡æ—¶æ–‡å­—
         * - å€’è®¡æ—¶â‰¤10ç§’æ—¶é«˜äº®æ˜¾ç¤ºï¼ˆåŠ ç²—ï¼‰
         */
        function updateCountdown() {
            countdownEl.textContent = `å€’è®¡æ—¶ï¼š${countdownTime}ç§’`;
            // å€’è®¡æ—¶å°‘äº10ç§’æ—¶é«˜äº®
            if (countdownTime <= 10) {
                countdownEl.style.color = '#e74c3c';
                countdownEl.style.fontWeight = 'bold';
            } else {
                countdownEl.style.color = '#e74c3c';
                countdownEl.style.fontWeight = '600';
            }
        }

        /**
         * ç”Ÿæˆä¸‹è½å…ƒç´ å‡½æ•°ï¼ˆçº¢åŒ…/é™·é˜±/éšœç¢ç‰©ï¼‰
         * - éšæœºç”Ÿæˆç±»å‹ï¼š60%æ™®é€šçº¢åŒ…ï¼Œ20%é™·é˜±çº¢åŒ…ï¼Œ20%éšœç¢ç‰©
         * - éšæœºä½ç½®ï¼ˆé¿å…è´´è¾¹ï¼‰
         * - éšæœºä¸‹è½é€Ÿåº¦ï¼ˆ2-5ç§’ï¼‰
         * - ç»‘å®šç¢°æ’æ£€æµ‹å®šæ—¶å™¨
         * - åŠ¨ç”»ç»“æŸåè‡ªåŠ¨ç§»é™¤å…ƒç´ 
         */
        function spawnRedPacketOrObstacle() {
            const gameAreaWidth = redPacketGameArea.offsetWidth; // æ¸¸æˆåŒºåŸŸå®½åº¦
            // éšæœºç±»å‹ï¼š60%æ™®é€šçº¢åŒ…ï¼Œ20%é™·é˜±çº¢åŒ…ï¼Œ20%éšœç¢ç‰©
            const randomType = Math.random();
            let element, isRedPacket, isTrapPacket;

            // ç”Ÿæˆæ™®é€šçº¢åŒ…
            if (randomType < 0.6) {
                element = document.createElement('div');
                element.className = 'red-packet';
                isRedPacket = true;
                isTrapPacket = false;
            } 
            // ç”Ÿæˆé™·é˜±çº¢åŒ…
            else if (randomType < 0.8) {
                element = document.createElement('div');
                element.className = 'trap-packet';
                isRedPacket = false;
                isTrapPacket = true;
            } 
            // ç”Ÿæˆéšœç¢ç‰©
            else {
                element = document.createElement('div');
                element.className = 'obstacle';
                isRedPacket = false;
                isTrapPacket = false;
            }

            // éšæœºä½ç½®ï¼šé¿å…è´´è¾¹ï¼ˆå·¦å³å„ç•™40pxï¼‰
            const randomX = Math.random() * (gameAreaWidth - 80) + 40;
            element.style.left = `${randomX}px`;
            // éšæœºä¸‹è½é€Ÿåº¦ï¼š2-5ç§’ï¼ˆæ•°å€¼è¶Šå¤§è¶Šæ…¢ï¼‰
            const fallDuration = Math.random() * 3 + 2;
            element.style.animationDuration = `${fallDuration}s`;

            // å°†å…ƒç´ æ·»åŠ åˆ°æ¸¸æˆåŒºåŸŸ
            redPacketGameArea.appendChild(element);

            /**
             * ç¢°æ’æ£€æµ‹å®šæ—¶å™¨ï¼ˆæ¯50msæ£€æµ‹ä¸€æ¬¡ï¼‰
             * - æ£€æµ‹å…ƒç´ ä¸ç©å®¶çš„ç¢°æ’
             * - æ£€æµ‹å…ƒç´ æ˜¯å¦è½åœ°ï¼ˆè¶…å‡ºæ¸¸æˆåŒºåŸŸåº•éƒ¨ï¼‰
             */
            const collisionCheck = setInterval(function () {
                const elRect = element.getBoundingClientRect(); // ä¸‹è½å…ƒç´ ä½ç½®/å°ºå¯¸
                const pRect = player.getBoundingClientRect(); // ç©å®¶ä½ç½®/å°ºå¯¸
                const gameAreaRect = redPacketGameArea.getBoundingClientRect(); // æ¸¸æˆåŒºåŸŸä½ç½®/å°ºå¯¸

                // ç¢°æ’æ£€æµ‹ï¼šå…ƒç´ ä¸ç©å®¶é‡å 
                if (elRect.bottom >= pRect.top && elRect.top <= pRect.bottom && elRect.right >= pRect.left && elRect.left <= pRect.right) {
                    clearInterval(collisionCheck); // åœæ­¢ç¢°æ’æ£€æµ‹
                    element.remove(); // ç§»é™¤ç¢°æ’çš„å…ƒç´ 

                    // æ™®é€šçº¢åŒ…ï¼šåŠ åˆ†+è®¡æ•°
                    if (isRedPacket) {
                        rpGameScore += 10;
                        redPacketCatchCount++;
                        updateRedPacketScore();
                    } 
                    // é™·é˜±çº¢åŒ…ï¼šæ‰£åˆ†ï¼ˆæœ€ä½0ï¼‰+ è®¡æ•° + ç©å®¶éœ‡åŠ¨
                    else if (isTrapPacket) {
                        rpGameScore = Math.max(0, rpGameScore - 15);
                        trapCatchCount++;
                        updateRedPacketScore();
                        player.style.animation = 'shake 0.5s'; // è§¦å‘éœ‡åŠ¨åŠ¨ç”»
                        setTimeout(() => player.style.animation = '', 500); // 0.5ç§’åæ¸…é™¤åŠ¨ç”»
                    } 
                    // éšœç¢ç‰©ï¼šæ‰£åˆ†ï¼ˆæœ€ä½0ï¼‰+ ç©å®¶éœ‡åŠ¨
                    else {
                        rpGameScore = Math.max(0, rpGameScore - 5);
                        updateRedPacketScore();
                        player.style.animation = 'shake 0.5s';
                        setTimeout(() => player.style.animation = '', 500);
                    }
                }

                // è½åœ°æ£€æµ‹ï¼šå…ƒç´ é¡¶éƒ¨è¶…å‡ºæ¸¸æˆåŒºåŸŸåº•éƒ¨
                if (elRect.top > gameAreaRect.bottom) {
                    clearInterval(collisionCheck); // åœæ­¢ç¢°æ’æ£€æµ‹
                    element.remove(); // ç§»é™¤è½åœ°çš„å…ƒç´ 

                    // æ™®é€šçº¢åŒ…è½åœ°ï¼šæ¼æ¥ï¼Œæ‰£åˆ†+è®¡æ•°
                    if (isRedPacket) {
                        rpGameScore = Math.max(0, rpGameScore - 2);
                        obstacleAvoidCount++;
                        updateRedPacketScore();
                    } 
                    // é™·é˜±çº¢åŒ…è½åœ°ï¼šé¿å¼€ï¼ŒåŠ åˆ†+è®¡æ•°
                    else if (isTrapPacket) {
                        rpGameScore += 5;
                        obstacleAvoidCount++;
                        updateRedPacketScore();
                    } 
                    // éšœç¢ç‰©è½åœ°ï¼šè®¡æ•°ï¼ˆä¸æ‰£åˆ†ï¼‰
                    else {
                        obstacleAvoidCount++;
                    }
                }
            }, 50);

            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ ï¼ˆå…œåº•ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼‰
            setTimeout(() => element.remove(), fallDuration * 1000);
        }

        /**
         * æ›´æ–°åˆ†æ•°/ç»Ÿè®¡æ˜¾ç¤ºå‡½æ•°
         * - æ›´æ–°å¾—åˆ†ã€å·²æ¥çº¢åŒ…ã€å·²é¿éšœç¢ã€é™·é˜±çº¢åŒ…æ•°é‡
         * - æ¸¸æˆä¸­å®æ—¶æ›´æ–°æ’è¡Œæ¦œé¢„è§ˆ
         */
        function updateRedPacketScore() {
            // æ›´æ–°åŸºç¡€æ˜¾ç¤º
            redPacketScore.textContent = `å¾—åˆ†ï¼š${rpGameScore}`;
            redPacketCount.textContent = redPacketCatchCount;
            obstacleCount.textContent = obstacleAvoidCount;
            trapCount.textContent = trapCatchCount;

            // æ¸¸æˆè¿è¡Œä¸­ä¸”æœªæš‚åœæ—¶ï¼Œå®æ—¶æ›´æ–°æ’è¡Œæ¦œé¢„è§ˆ
            if (rpGameRunning && !rpGamePaused) {
                // ä¸´æ—¶åˆå¹¶å†å²æ•°æ®+å½“å‰æˆç»©ï¼Œæ’åºåå–å‰5
                const tempRankData = [...rankData, { score: rpGameScore, time: 60 - countdownTime }];
                const sortedTempData = tempRankData.sort((a, b) => b.score - a.score).slice(0, 5);
                renderRankList(sortedTempData); // æ¸²æŸ“ä¸´æ—¶æ’è¡Œæ¦œ
            }
        }

        /**
         * åˆå§‹åŒ–æ’è¡Œæ¦œå‡½æ•°
         * - è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œæ˜¾ç¤ºå†å²æ’è¡Œæ¦œæ•°æ®
         */
        function initRankList() {
            renderRankList(rankData);
        }

        /**
         * æ¸²æŸ“æ’è¡Œæ¦œå‡½æ•°
         * @param {Array} data - æ’è¡Œæ¦œæ•°æ®ï¼ˆ[{score: å¾—åˆ†, time: ç”¨æ—¶}]ï¼‰
         * - æ— æ•°æ®æ—¶æ˜¾ç¤ºæç¤ºæ–‡å­—
         * - æœ‰æ•°æ®æ—¶éå†ç”Ÿæˆåˆ—è¡¨é¡¹
         */
        function renderRankList(data) {
            rankList.innerHTML = ''; // æ¸…ç©ºåŸæœ‰å†…å®¹

            // æ— æ•°æ®æ—¶æ˜¾ç¤ºæç¤º
            if (data.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'æš‚æ— æ¸¸æˆè®°å½•ï¼Œå¿«æ¥æŒ‘æˆ˜å§ï¼';
                rankList.appendChild(li);
                return;
            }

            // éå†æ•°æ®ç”Ÿæˆæ’è¡Œæ¦œé¡¹
            data.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>ç¬¬${index + 1}å</span>
                    <span>å¾—åˆ†ï¼š${item.score} | ç”¨æ—¶ï¼š${item.time}s</span>
                `;
                rankList.appendChild(li);
            });
        }
    </script>
</body>

</html>