<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥çº¢åŒ… - é©¬å¹´æ–°æ˜¥å°æ¸¸æˆ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5eedc 0%, #f8f5f0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-title {
            font-size: clamp(24px, 5vw, 36px);
            color: #e67e22;
            margin-bottom: 10px;
        }

        .back-btn {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(90deg, #e67e22, #d35400);
            color: #fff;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        /* åˆ†æ•°æ˜¾ç¤º */
        .game-score {
            font-size: 20px;
            color: #e67e22;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            background-color: #f5eedc;
            padding: 10px;
            border-radius: 10px;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            width: 100%;
            height: clamp(300px, 60vw, 450px);
            background-color: #f8f5f0;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        /* ç©å®¶ */
        .player {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: clamp(50px, 10vw, 80px);
            height: clamp(50px, 10vw, 80px);
            background-image: url("https://picsum.photos/seed/player/100/100");
            background-size: cover;
            border-radius: 50%;
            z-index: 10;
            transition: left 0.1s ease;
        }

        /* çº¢åŒ…å’Œéšœç¢ç‰© */
        .red-packet {
            position: absolute;
            top: -50px;
            width: clamp(40px, 8vw, 60px);
            height: clamp(50px, 10vw, 70px);
            background-image: url("https://picsum.photos/seed/redpacket/100/120");
            background-size: cover;
            animation: fall linear;
        }

        .obstacle {
            position: absolute;
            top: -50px;
            width: clamp(40px, 8vw, 60px);
            height: clamp(40px, 8vw, 60px);
            background-image: url("https://picsum.photos/seed/obstacle/100/100");
            background-size: cover;
            animation: fall linear;
        }

        @keyframes fall {
            to {
                transform: translateY(clamp(300px, 60vw, 450px));
            }
        }

        /* æ¸¸æˆç»Ÿè®¡ */
        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f5eedc;
            border-radius: 10px;
        }

        .stat-item {
            font-size: 16px;
            color: #e67e22;
            font-weight: 600;
        }

        /* æ¸¸æˆæ§åˆ¶æŒ‰é’® */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .game-btn {
            padding: 10px 25px;
            background: linear-gradient(90deg, #e67e22, #d35400);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            min-width: 100px;
        }

        /* æ’è¡Œæ¦œ */
        .game-rank {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f5eedc;
        }

        .rank-title {
            font-size: 18px;
            color: #e67e22;
            margin-bottom: 10px;
            text-align: center;
        }

        .rank-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rank-list li {
            padding: 8px 15px;
            background-color: #fff;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            border-left: 3px solid #f1c40f;
        }

        /* éœ‡åŠ¨åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            25% { transform: translateX(-50%) rotate(-5deg); }
            75% { transform: translateX(-50%) rotate(5deg); }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <a href="main.html" class="back-btn">â† è¿”å›ä¸»é¡µé¢</a>
        <h1 class="game-title">æ¥çº¢åŒ… ğŸ§§</h1>
    </div>

    <div class="game-container">
        <div class="game-score" id="redPacketScore">å¾—åˆ†ï¼š0</div>
        
        <div class="game-area" id="redPacketGameArea">
            <div class="player" id="player"></div>
        </div>

        <div class="game-stats">
            <div class="stat-item">å·²æ¥çº¢åŒ…ï¼š<span id="redPacketCount">0</span></div>
            <div class="stat-item">å·²é¿éšœç¢ï¼š<span id="obstacleCount">0</span></div>
            <div class="stat-item">æ¸¸æˆæ—¶é—´ï¼š<span id="gameTime">0</span>ç§’</div>
        </div>

        <div class="game-controls">
            <button class="game-btn" id="startRedPacketGame">å¼€å§‹</button>
            <button class="game-btn" id="pauseRedPacketGame" disabled>æš‚åœ</button>
            <button class="game-btn" id="resetRedPacketGame" disabled>é‡ç½®</button>
        </div>

        <div class="game-rank">
            <h3 class="rank-title">æ’è¡Œæ¦œ</h3>
            <ul class="rank-list" id="rankList"></ul>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ è·å–
        const redPacketScore = document.getElementById('redPacketScore');
        const redPacketGameArea = document.getElementById('redPacketGameArea');
        const player = document.getElementById('player');
        const startRedPacketGame = document.getElementById('startRedPacketGame');
        const pauseRedPacketGame = document.getElementById('pauseRedPacketGame');
        const resetRedPacketGame = document.getElementById('resetRedPacketGame');
        const redPacketCount = document.getElementById('redPacketCount');
        const obstacleCount = document.getElementById('obstacleCount');
        const gameTime = document.getElementById('gameTime');
        const rankList = document.getElementById('rankList');

        // æ¸¸æˆçŠ¶æ€å˜é‡
        let rpGameScore = 0;
        let rpGameInterval = null;
        let rpGameRunning = false;
        let rpGamePaused = false;
        let rpGameTime = 0;
        let rpTimeInterval = null;
        let redPacketCatchCount = 0;
        let obstacleAvoidCount = 0;
        let rankData = [];

        // åˆå§‹åŒ–æ’è¡Œæ¦œ
        initRankList();

        // æ¸¸æˆæ§åˆ¶äº‹ä»¶
        startRedPacketGame.addEventListener('click', function() {
            if (!rpGameRunning) {
                startRedPacketGameFunc();
            } else if (rpGamePaused) {
                resumeRedPacketGame();
            }
        });

        pauseRedPacketGame.addEventListener('click', pauseRedPacketGameFunc);
        resetRedPacketGame.addEventListener('click', resetRedPacketGameFunc);

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', function(e) {
            if (!rpGameRunning || rpGamePaused) return;
            const playerRect = player.getBoundingClientRect();
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const moveStep = 15;

            switch(e.key) {
                case 'ArrowLeft':
                    if (playerRect.left > gameAreaRect.left) {
                        player.style.left = `${player.offsetLeft - moveStep}px`;
                    }
                    break;
                case 'ArrowRight':
                    if (playerRect.right < gameAreaRect.right) {
                        player.style.left = `${player.offsetLeft + moveStep}px`;
                    }
                    break;
            }
        });

        // ç§»åŠ¨ç«¯è§¦æ‘¸æ§åˆ¶
        redPacketGameArea.addEventListener('touchmove', function(e) {
            if (!rpGameRunning || rpGamePaused) return;
            e.preventDefault();
            const touch = e.touches[0];
            const gameAreaRect = redPacketGameArea.getBoundingClientRect();
            const playerHalfWidth = player.offsetWidth / 2;
            const relativeX = touch.clientX - gameAreaRect.left;

            if (relativeX > playerHalfWidth && relativeX < gameAreaRect.width - playerHalfWidth) {
                player.style.left = `${relativeX - playerHalfWidth}px`;
            }
        });

        // å¼€å§‹æ¸¸æˆ
        function startRedPacketGameFunc() {
            rpGameRunning = true;
            rpGamePaused = false;
            rpGameScore = 0;
            rpGameTime = 0;
            redPacketCatchCount = 0;
            obstacleAvoidCount = 0;
            updateRedPacketScore();

            // é‡ç½®ç©å®¶ä½ç½®
            player.style.left = '50%';
            clearRedPacketGameArea();

            // ç”Ÿæˆçº¢åŒ…/éšœç¢ç‰©å®šæ—¶å™¨
            rpGameInterval = setInterval(spawnRedPacketOrObstacle, 800);
            // æ¸¸æˆè®¡æ—¶å®šæ—¶å™¨
            rpTimeInterval = setInterval(function() {
                rpGameTime++;
                gameTime.textContent = rpGameTime;
            }, 1000);

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'ç»§ç»­';
            pauseRedPacketGame.disabled = false;
            resetRedPacketGame.disabled = false;
        }

        // æš‚åœæ¸¸æˆ
        function pauseRedPacketGameFunc() {
            if (rpGameRunning && !rpGamePaused) {
                rpGamePaused = true;
                clearInterval(rpGameInterval);
                clearInterval(rpTimeInterval);

                // æš‚åœä¸‹è½åŠ¨ç”»
                document.querySelectorAll('.red-packet, .obstacle').forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
                startRedPacketGame.textContent = 'ç»§ç»­';
            }
        }

        // æ¢å¤æ¸¸æˆ
        function resumeRedPacketGame() {
            rpGamePaused = false;
            rpGameInterval = setInterval(spawnRedPacketOrObstacle, 800);
            rpTimeInterval = setInterval(function() {
                rpGameTime++;
                gameTime.textContent = rpGameTime;
            }, 1000);

            // æ¢å¤ä¸‹è½åŠ¨ç”»
            document.querySelectorAll('.red-packet, .obstacle').forEach(el => {
                el.style.animationPlayState = 'running';
            });
        }

        // åœæ­¢æ¸¸æˆ
        function stopRedPacketGame() {
            rpGameRunning = false;
            rpGamePaused = false;
            clearInterval(rpGameInterval);
            clearInterval(rpTimeInterval);
            clearRedPacketGameArea();

            // é‡ç½®æ•°æ®
            rpGameScore = 0;
            rpGameTime = 0;
            redPacketCatchCount = 0;
            obstacleAvoidCount = 0;
            updateRedPacketScore();
            gameTime.textContent = 0;
            player.style.left = '50%';

            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startRedPacketGame.textContent = 'å¼€å§‹';
            pauseRedPacketGame.disabled = true;
            resetRedPacketGame.disabled = true;
        }

        // é‡ç½®æ¸¸æˆ
        function resetRedPacketGameFunc() {
            stopRedPacketGame();
            startRedPacketGameFunc();
        }

        // æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
        function clearRedPacketGameArea() {
            document.querySelectorAll('.red-packet, .obstacle').forEach(el => el.remove());
        }

        // ç”Ÿæˆçº¢åŒ…/éšœç¢ç‰©
        function spawnRedPacketOrObstacle() {
            const gameAreaWidth = redPacketGameArea.offsetWidth;
            const isRedPacket = Math.random() > 0.3; // 70%çº¢åŒ…ï¼Œ30%éšœç¢ç‰©
            const element = document.createElement('div');
            element.className = isRedPacket ? 'red-packet' : 'obstacle';

            // éšæœºä½ç½®ï¼ˆé¿å…è´´è¾¹ï¼‰
            const randomX = Math.random() * (gameAreaWidth - 80) + 40;
            element.style.left = `${randomX}px`;
            // éšæœºä¸‹è½é€Ÿåº¦ï¼ˆ2-5ç§’ï¼‰
            const fallDuration = Math.random() * 3 + 2;
            element.style.animationDuration = `${fallDuration}s`;

            redPacketGameArea.appendChild(element);

            // ç¢°æ’æ£€æµ‹
            const collisionCheck = setInterval(function() {
                const elRect = element.getBoundingClientRect();
                const pRect = player.getBoundingClientRect();
                const gameAreaRect = redPacketGameArea.getBoundingClientRect();

                // æ£€æµ‹ç¢°æ’
                if (elRect.bottom >= pRect.top && elRect.top <= pRect.bottom && elRect.right >= pRect.left && elRect.left <= pRect.right) {
                    clearInterval(collisionCheck);
                    element.remove();
                    if (isRedPacket) {
                        // æ¥çº¢åŒ…åŠ åˆ†
                        rpGameScore += 10;
                        redPacketCatchCount++;
                        updateRedPacketScore();
                    } else {
                        // ç¢°éšœç¢ç‰©å‡åˆ†+éœ‡åŠ¨
                        rpGameScore = Math.max(0, rpGameScore - 5);
                        updateRedPacketScore();
                        player.style.animation = 'shake 0.5s';
                        setTimeout(() => player.style.animation = '', 500);
                    }
                }

                // æ£€æµ‹è½åœ°
                if (elRect.top > gameAreaRect.bottom) {
                    clearInterval(collisionCheck);
                    element.remove();
                    if (isRedPacket) {
                        // æ¼æ¥çº¢åŒ…å‡åˆ†
                        rpGameScore = Math.max(0, rpGameScore - 2);
                        obstacleAvoidCount++;
                        updateRedPacketScore();
                    } else {
                        obstacleAvoidCount++;
                    }
                }
            }, 50);

            // åŠ¨ç”»ç»“æŸç§»é™¤å…ƒç´ 
            setTimeout(() => element.remove(), fallDuration * 1000);
        }

        // æ›´æ–°åˆ†æ•°/ç»Ÿè®¡
        function updateRedPacketScore() {
            redPacketScore.textContent = `å¾—åˆ†ï¼š${rpGameScore}`;
            redPacketCount.textContent = redPacketCatchCount;
            obstacleCount.textContent = obstacleAvoidCount;
            // æ›´æ–°æ’è¡Œæ¦œ
            if (rpGameRunning) {
                rankData.push({ score: rpGameScore, time: rpGameTime });
                rankData = rankData.sort((a, b) => b.score - a.score).slice(0, 5);
                initRankList();
            }
        }

        // åˆå§‹åŒ–æ’è¡Œæ¦œ
        function initRankList() {
            rankList.innerHTML = '';
            if (rankData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'æš‚æ— æ¸¸æˆè®°å½•ï¼Œå¿«æ¥æŒ‘æˆ˜å§ï¼';
                rankList.appendChild(li);
                return;
            }
            rankData.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>ç¬¬${index + 1}å</span>
                    <span>å¾—åˆ†ï¼š${item.score} | ç”¨æ—¶ï¼š${item.time}s</span>
                `;
                rankList.appendChild(li);
            });
        }
    </script>
</body>
</html>